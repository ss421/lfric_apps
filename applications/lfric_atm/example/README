This "example" directory contains a configuration file that enables
you to run lfric_atm from the command line. This directory and example
directories for the other LFRic applications within the LFRic apps code
repository are colloquially called "canned" configurations as they are
designed to be run from the command line straight out of the can
without needing to run the Rose Stem application.

To run them without using Rose Stem, check out a working copy of a
branch, then follow the instructions found here:

https://code.metoffice.gov.uk/trac/lfric_apps/wiki/local_builds

To summarise the instructions, first ensure you have your software
environment set up to build LFRic applications. Then run the
following:

$ cd r12345_workingCopy
$ ./build/local_build.py -a lfric_atm -p meto-spice
<snip lots of output>
$ cd applications/lfric_atm/example
$ ../bin/lfric_atm configuration.nml ;# Runs lfric_atm with the configuration file as input

Note the "-p meto-spice" refers to the standard PSyclone
transformation used in the Rose Stem suite at the Met Office for
building on the Spice cluster, so the generated executable should be
the same as that generated by the suite. The script applies basic
OpenMP transformations to the code.

To ensure canned configurations are kept up to date with changes to
the application, the Rose Stem developer test suite tests the canned
configurations to ensure they run to completion without errors.

configuration.nml
-----------------

This file holds the application configuration. It configures a "single
column" run of lfric_atm. It is configured to use the mesh file in
this directory which is, in reality, not a single column mesh, but a
2x2 biperiodic mesh. However, the configuration is designed in such a
way as each column is computed independently from the other columns
and, in fact, gives identical results for each column.

The configuration was originally copied from the Rose Stem
"run_lfric_atm_scm_gal9_bomex" configuration. Note that the Rose Stem version
may have diverged from this configuration as the two are not actively
kept in line.

As this configuration is tested routinely in the test suite, it is
always expected to successfully run to completion.

To run other configurations
---------------------------

If you wish to run a different configuration such as a global
configuration, you can create a configuration based on one of the Rose
Stem configurations. The easiest way to do this is to run the Rose
Stem developer test suite and then use the contents of one of the run
directories that are generated by the suite.

Each such directory should contain a configuration.nml file, an
iodef.xml file, a start dump file, a mesh file and, potentially, a
directory of data files. These files are required to run the
application. Assuming the Rose Stem test passed, the directory will
contain various netCDF output files, and text output files from the
model and from XIOS.

For example, the current form of the name for a short aquaplanet
configuration using a C12 cubed sphere mesh is:

~/cylc-run/[your-branch-name]-lfric_atm-meto-spice-developer/work/1/run_lfric_atm_aquaplanet_short_C12_dt-300p0_intel_64-bit_fast-debug

Some configurations may need to be run on multiple MPI ranks:

$ mpirun -n 6 ../bin/lfric_atm configuration.nml

Some configurations may need to be run without OpenMP threads. If so,
set the following environment variable:

$ export OMP_NUM_THREADS=1
